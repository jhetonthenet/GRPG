<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>G RPG Library Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!--
    BASIC STYLES
    ------------
    Dark background, light text, simple 2-column grid of lists
    plus a details panel below.
  -->
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #111827;  /* dark slate */
      color: #e5e7eb;       /* light gray text */
      min-height: 100vh;
    }

    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      font-size: 0.9rem;
      color: #9ca3af;
      margin-bottom: 1.5rem;
    }

    .meta-bar {
      background: #111827;
      border-radius: 999px;
      border: 1px solid #374151;
      padding: 0.5rem 1rem;
      margin-bottom: 1.5rem;
      font-size: 0.85rem;
      color: #9ca3af;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      white-space: nowrap;
      overflow: hidden;
    }

    .meta-bar span {
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    .section-card {
      border-top: 1px solid #374151;
      padding-top: 0.75rem;
    }

    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .list-help {
      font-size: 0.8rem;
      color: #6b7280;
      margin-bottom: 0.5rem;
    }

    .record-list {
      list-style: none;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 0.25rem;
    }

    .record-button {
      width: 100%;
      text-align: left;
      font-size: 0.9rem;
      padding: 0.4rem 0.6rem;
      margin-bottom: 0.25rem;
      border-radius: 0.375rem;
      border: 1px solid transparent;
      background: transparent;
      color: inherit;
      cursor: pointer;
      transition: background 0.12s ease, border-color 0.12s ease;
    }

    .record-button:hover {
      background: #1f2937;
      border-color: #374151;
    }

    .record-button.active {
      background: #111827;
      border-color: #10b981;  /* emerald accent */
      color: #ecfdf5;
    }

    .record-name {
      font-weight: 500;
      margin-bottom: 0.1rem;
    }

    .record-summary {
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .details-card {
      border-radius: 0.75rem;
      border: 1px solid #374151;
      background: #020617;
      padding: 1rem 1.25rem;
    }

    .details-category {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }

    .details-name {
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .details-tags {
      font-size: 0.75rem;
      color: #9ca3af;
      margin-bottom: 0.75rem;
    }

    .details-summary {
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }

    .details-description {
      font-size: 0.9rem;
      color: #d1d5db;
      margin-bottom: 0.75rem;
      white-space: pre-line;
    }

    .details-section-label {
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
      margin: 0.75rem 0 0.25rem;
    }

    .details-body-text {
      font-size: 0.85rem;
      color: #e5e7eb;
      white-space: pre-line;
    }

    .muted {
      color: #6b7280;
      font-size: 0.85rem;
    }
  </style>
</head>

<body>
  <div class="app-container">
    <header>
      <h1>G RPG Library Viewer</h1>
      <p class="subtitle">
        Simple viewer for your shared G&nbsp;RPG data file
        (<code>GRPGLibrary0.0.1.js</code>).
      </p>
    </header>

    <!--
      META BAR
      --------
      Filled from GRPG_LIBRARY.meta.
      Shows schema version, data version, and last updated date.
    -->
    <div class="meta-bar" id="metaBar">
      <span>Loading library...</span>
    </div>

    <!--
      FOUR CATEGORY LISTS
      -------------------
      Races, Classes, Traits, Abilities.
      Each <ul> is populated by JavaScript using GRPG_LIBRARY.<category>.
    -->
    <main>
      <section class="grid">
        <div class="section-card">
          <h2 class="section-title">Races</h2>
          <p class="list-help">Click a race to see its full details.</p>
          <ul id="raceList" class="record-list"></ul>
        </div>

        <div class="section-card">
          <h2 class="section-title">Classes</h2>
          <p class="list-help">Click a class to see its full details.</p>
          <ul id="classList" class="record-list"></ul>
        </div>

        <div class="section-card">
          <h2 class="section-title">Traits</h2>
          <p class="list-help">Click a trait to see its full details.</p>
          <ul id="traitList" class="record-list"></ul>
        </div>

        <div class="section-card">
          <h2 class="section-title">Abilities</h2>
          <p class="list-help">Click an ability to see its full details.</p>
          <ul id="abilityList" class="record-list"></ul>
        </div>
      </section>

      <!--
        DETAILS PANEL
        -------------
        When you click a record in any list, we update this panel
        to show all the info about that record.
      -->
      <section class="details-card" id="detailsPanel">
        <p class="muted">Select a race, class, trait, or ability to see its details here.</p>
      </section>
    </main>
  </div>

  <!--
    1) Load the data file first.
       This creates global window.GRPG_LIBRARY and window.TAG_DEFINITIONS.
  -->
  <script src="GRPGLibrary0.0.1.js"></script>

  <!--
    2) Simple script that reads GRPG_LIBRARY and renders the page.
  -->
  <script>
    // Keep track of the currently selected button so we can style it.
    var currentActiveButton = null;

    // Helper: safely get the library object (or null if missing).
    function getLibrary() {
      if (window.GRPG_LIBRARY) {
        return window.GRPG_LIBRARY;
      }
      return null;
    }

    // Fill in the meta bar at the top of the page.
    function renderMetaInfo(library) {
      var meta = library.meta || {};
      var schemaVersion = meta.schemaVersion || "unknown schema";
      var dataVersion   = meta.dataVersion   || "unknown data version";
      var lastUpdated   = meta.lastUpdated   || "unknown date";

      var metaBar = document.getElementById("metaBar");
      metaBar.innerHTML =
        "<span>Schema: " + schemaVersion + "</span>" +
        "<span>Data: " + dataVersion + "</span>" +
        "<span>Last updated: " + lastUpdated + "</span>";
    }

    // Create one clickable list item for a record (race, class, etc.).
    function addRecordButton(categoryName, record, listElement) {
      var li = document.createElement("li");

      var button = document.createElement("button");
      button.className = "record-button";

      var nameDiv = document.createElement("div");
      nameDiv.className = "record-name";
      nameDiv.textContent = record.name || "(Unnamed)";

      var summaryDiv = document.createElement("div");
      summaryDiv.className = "record-summary";
      summaryDiv.textContent = record.summary || "";

      button.appendChild(nameDiv);
      button.appendChild(summaryDiv);

      // When you click this item:
      // 1) mark it as active (green border),
      // 2) update the details panel with showDetails().
      button.addEventListener("click", function () {
        if (currentActiveButton) {
          currentActiveButton.classList.remove("active");
        }
        button.classList.add("active");
        currentActiveButton = button;

        showDetails(categoryName, record);
      });

      li.appendChild(button);
      listElement.appendChild(li);
    }

    // Render all four category lists from the library object.
    function renderCategoryLists(library) {
      var raceList    = document.getElementById("raceList");
      var classList   = document.getElementById("classList");
      var traitList   = document.getElementById("traitList");
      var abilityList = document.getElementById("abilityList");

      raceList.innerHTML    = "";
      classList.innerHTML   = "";
      traitList.innerHTML   = "";
      abilityList.innerHTML = "";

      var raceRecords    = library.races    ? Object.values(library.races)    : [];
      var classRecords   = library.classes  ? Object.values(library.classes)  : [];
      var traitRecords   = library.traits   ? Object.values(library.traits)   : [];
      var abilityRecords = library.abilities? Object.values(library.abilities): [];

      for (var i = 0; i < raceRecords.length; i++) {
        addRecordButton("Race", raceRecords[i], raceList);
      }
      for (var j = 0; j < classRecords.length; j++) {
        addRecordButton("Class", classRecords[j], classList);
      }
      for (var k = 0; k < traitRecords.length; k++) {
        addRecordButton("Trait", traitRecords[k], traitList);
      }
      for (var m = 0; m < abilityRecords.length; m++) {
        addRecordButton("Ability", abilityRecords[m], abilityList);
      }
    }

    // Update the big details panel with the chosen record.
    function showDetails(categoryName, record) {
      var detailsPanel = document.getElementById("detailsPanel");

      var tagsArray = Array.isArray(record.tags) ? record.tags : [];
      var tags = tagsArray.length > 0 ? tagsArray.join(", ") : "—";

      var rulesText = "";
      if (record.mechanics && typeof record.mechanics.rulesText === "string") {
        rulesText = record.mechanics.rulesText;
      }

      var html = "";

      html += '<div class="details-category">' + categoryName + "</div>";
      html += '<div class="details-name">' + (record.name || "(Unnamed)") + "</div>";
      html += '<div class="details-tags"><strong>ID:</strong> ' +
        (record.id || "—") +
        " | <strong>Tags:</strong> " +
        tags +
        "</div>";

      if (record.summary) {
        html += '<div class="details-summary">' + record.summary + "</div>";
      }

      if (record.description) {
        html += '<div class="details-description">' + record.description + "</div>";
      }

      if (rulesText) {
        html += '<div class="details-section-label">Rules</div>';
        html += '<div class="details-body-text">' + rulesText + "</div>";
      }

      if (record.source) {
        var srcText = (record.source.book || "");
        if (record.source.page) {
          srcText += ", p. " + record.source.page;
        }
        html += '<div class="details-section-label">Source</div>';
        html += '<div class="details-body-text">' + srcText + "</div>";
      }

      if (record.version || record.createdAt || record.updatedAt) {
        html += '<div class="details-section-label">Version</div>';
        var versionParts = [];
        if (record.version) {
          var major = (record.version.major !== undefined) ? record.version.major : "?";
          var minor = (record.version.minor !== undefined) ? record.version.minor : "?";
          versionParts.push("v" + major + "." + minor);
        }
        if (record.createdAt) {
          versionParts.push("created " + record.createdAt);
        }
        if (record.updatedAt) {
          versionParts.push("updated " + record.updatedAt);
        }
        html += '<div class="details-body-text">' + versionParts.join(" · ") + "</div>";
      }

      detailsPanel.innerHTML = html;
    }

    // MAIN INITIALIZATION
    // -------------------
    (function init() {
      var library = getLibrary();

      // If something went wrong loading the data file, show an error.
      if (!library) {
        var detailsPanel = document.getElementById("detailsPanel");
        detailsPanel.innerHTML =
          '<p class="muted">Error: GRPGLibrary0.0.1.js did not load correctly. ' +
          'Check that the file name matches exactly and is in the same folder as index.html.</p>';
        return;
      }

      renderMetaInfo(library);
      renderCategoryLists(library);

      // Optionally show the first race by default so the panel isn't empty.
      var firstRace = library.races ? Object.values(library.races)[0] : null;
      if (firstRace) {
        showDetails("Race", firstRace);
      }
    })();
  </script>
</body>
</html>

